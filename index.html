<!DOCTYPE html>
<html>
<head>
    <title>BUILDING A SIMPLE VOICE APP IN IOS</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style type="text/css">
        /* GitHub stylesheet for MarkdownPad (http://markdownpad.com) */
        /* Author: Nicolas Hery - http://nicolashery.com */
        /* Version: b13fe65ca28d2e568c6ed5d7f06581183df8f2ff */
        /* Source: https://github.com/nicolahery/markdownpad-github */

        /* RESET
        =============================================================================*/

        /* CODE
        =============================================================================*/

        pre, code, tt {
          font-size: 12px;
          font-family: Consolas, "Liberation Mono", Courier, monospace;
        }

        code, tt {
          margin: 0 0px;
          padding: 0px 0px;
          white-space: nowrap;
          background-color: #f8f8f8;
          border:0;
        }

        pre>code {
          margin: 0;
          padding: 0;
          white-space: pre;
          border: none;
          background: transparent;
        }

        pre {
          background-color: #f8f8f8;
          
          font-size: 13px;
          line-height: 19px;
          overflow: auto;
          padding: 6px 10px;
          
        }

        pre code, pre tt {
          background-color: transparent;
          border: none;
        }

        kbd {
            -moz-border-bottom-colors: none;
            -moz-border-left-colors: none;
            -moz-border-right-colors: none;
            -moz-border-top-colors: none;
            background-color: #DDDDDD;
            background-image: linear-gradient(#F1F1F1, #DDDDDD);
            background-repeat: repeat-x;
            border-color: #DDDDDD #CCCCCC #CCCCCC #DDDDDD;
            border-image: none;
            border-radius: 2px 2px 2px 2px;
            border-style: solid;
            border-width: 1px;
            font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
            line-height: 10px;
            padding: 1px 4px;
        }
        /* IMAGES
        =============================================================================*/
        img {
          max-width: 100%;
          margin:auto;
        }
    </style>
    <style type="text/css">
        .highlight  { background: #ffffff; }
        .highlight .c { color: #999988; font-style: italic } /* Comment */
        .highlight .err { color: #a61717; background-color: #e3d2d2 } /* Error */
        .highlight .k { font-weight: bold } /* Keyword */
        .highlight .o { font-weight: bold } /* Operator */
        .highlight .cm { color: #999988; font-style: italic } /* Comment.Multiline */
        .highlight .cp { color: #999999; font-weight: bold } /* Comment.Preproc */
        .highlight .c1 { color: #999988; font-style: italic } /* Comment.Single */
        .highlight .cs { color: #999999; font-weight: bold; font-style: italic } /* Comment.Special */
        .highlight .gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
        .highlight .gd .x { color: #000000; background-color: #ffaaaa } /* Generic.Deleted.Specific */
        .highlight .ge { font-style: italic } /* Generic.Emph */
        .highlight .gr { color: #aa0000 } /* Generic.Error */
        .highlight .gh { color: #999999 } /* Generic.Heading */
        .highlight .gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
        .highlight .gi .x { color: #000000; background-color: #aaffaa } /* Generic.Inserted.Specific */
        .highlight .go { color: #888888 } /* Generic.Output */
        .highlight .gp { color: #555555 } /* Generic.Prompt */
        .highlight .gs { font-weight: bold } /* Generic.Strong */
        .highlight .gu { color: #aaaaaa } /* Generic.Subheading */
        .highlight .gt { color: #aa0000 } /* Generic.Traceback */
        .highlight .kc { font-weight: bold } /* Keyword.Constant */
        .highlight .kd { font-weight: bold } /* Keyword.Declaration */
        .highlight .kp { font-weight: bold } /* Keyword.Pseudo */
        .highlight .kr { font-weight: bold } /* Keyword.Reserved */
        .highlight .kt { color: #445588; font-weight: bold } /* Keyword.Type */
        .highlight .m { color: #009999 } /* Literal.Number */
        .highlight .s { color: #d14 } /* Literal.String */
        .highlight .na { color: #008080 } /* Name.Attribute */
        .highlight .nb { color: #0086B3 } /* Name.Builtin */
        .highlight .nc { color: #445588; font-weight: bold } /* Name.Class */
        .highlight .no { color: #008080 } /* Name.Constant */
        .highlight .ni { color: #800080 } /* Name.Entity */
        .highlight .ne { color: #990000; font-weight: bold } /* Name.Exception */
        .highlight .nf { color: #990000; font-weight: bold } /* Name.Function */
        .highlight .nn { color: #555555 } /* Name.Namespace */
        .highlight .nt { color: #000080 } /* Name.Tag */
        .highlight .nv { color: #008080 } /* Name.Variable */
        .highlight .ow { font-weight: bold } /* Operator.Word */
        .highlight .w { color: #bbbbbb } /* Text.Whitespace */
        .highlight .mf { color: #009999 } /* Literal.Number.Float */
        .highlight .mh { color: #009999 } /* Literal.Number.Hex */
        .highlight .mi { color: #009999 } /* Literal.Number.Integer */
        .highlight .mo { color: #009999 } /* Literal.Number.Oct */
        .highlight .sb { color: #d14 } /* Literal.String.Backtick */
        .highlight .sc { color: #d14 } /* Literal.String.Char */
        .highlight .sd { color: #d14 } /* Literal.String.Doc */
        .highlight .s2 { color: #d14 } /* Literal.String.Double */
        .highlight .se { color: #d14 } /* Literal.String.Escape */
        .highlight .sh { color: #d14 } /* Literal.String.Heredoc */
        .highlight .si { color: #d14 } /* Literal.String.Interpol */
        .highlight .sx { color: #d14 } /* Literal.String.Other */
        .highlight .sr { color: #009926 } /* Literal.String.Regex */
        .highlight .s1 { color: #d14 } /* Literal.String.Single */
        .highlight .ss { color: #990073 } /* Literal.String.Symbol */
        .highlight .bp { color: #999999 } /* Name.Builtin.Pseudo */
        .highlight .vc { color: #008080 } /* Name.Variable.Class */
        .highlight .vg { color: #008080 } /* Name.Variable.Global */
        .highlight .vi { color: #008080 } /* Name.Variable.Instance */
        .highlight .il { color: #009999 } /* Literal.Number.Integer.Long */
        /*.task-list {
        padding-left:10px;
        margin-bottom:0;
        }

        .task-list li {
            margin-left: 20px;
        }

        .task-list-item {
        list-style-type:none;
        padding-left:10px;
        }

        .task-list-item label {
        font-weight:400;
        }

        .task-list-item.enabled label {
        cursor:pointer;
        }

        .task-list-item+.task-list-item {
        margin-top:3px;
        }

        .task-list-item-checkbox {
        display:inline-block;
        margin-left:-20px;
        margin-right:3px;
        vertical-align:1px;
        }*/
    </style>
    <link rel="stylesheet" type="text/css" href="http://tutorial.sinch.com/index.css">
    <script async="" src="//www.google-analytics.com/analytics.js"></script>
    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
    (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date(); a = s.createElement(o),
            m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-50667467-2', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body data-twttr-rendered="true">
    <div id="sidebar">
        <a href="http://www.sinch.com"><img id="logo" src="http://tutorial.sinch.com/logo.png"></a>

        <div id="sinch-signup">
            <div id="mailing-list-text">Would you like to hear<br> about future tuturials?</div>
            <a href="http://www.sinch.com/dashboard/#/signup" id="sinch-signup-button" target="_blank">YES!</a>
        </div>
        <div id="tweet">
            Questions?
            <iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" src="http://platform.twitter.com/widgets/tweet_button.1406859257.html#_=1407278299749&amp;count=none&amp;id=twitter-widget-0&amp;lang=en&amp;original_referer=http%3A%2F%2Ftutorial.sinch.com%2Fandroid-messaging-tutorial%2F&amp;related=SinchDev&amp;screen_name=SinchDev&amp;share_with_retweet=never&amp;size=m&amp;text=I%20have%20a%20question%20about%20your%20Android%20messaging%20tutorial!&amp;type=mention" class="twitter-mention-button twitter-tweet-button twitter-mention-button twitter-count-none" title="Twitter Tweet Button" data-twttr-rendered="true" style="width: 137px; height: 20px;"></iframe>
            <script>!function (d, s, id) { var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https'; if (!d.getElementById(id)) { js = d.createElement(s); js.id = id; js.src = p + '://platform.twitter.com/widgets.js'; fjs.parentNode.insertBefore(js, fjs); } }(document, 'script', 'twitter-wjs');</script>
        </div>
    </div>
    <div id="wrapper">
        <h1>Building a simple voice app in iOS</h1>

        <p>In this tutorial you will learn how to use the Sinch SDK to make a voice call.  </p>

        <h2>Start</h2>

        <p>
            If you don't have an account with Sinch, sign up for one at <a href="http://www.sinch.com/signup">www.sinch.com/signup</a>.<br>
            Setup a new Application using the <a href="http://www.sinch.com/dashboard/#/apps" title="Sinch Dashboard">Dashboard</a>, and take note of you application- key and secret.
        </p>

        <ul class="task-list">
            <li>Launch Xcode and create a new project (File&gt;New&gt;Project). </li>
            <li>Select “Single View Application” and click next</li>
            <li>Name the project 'CallingApp' and save it.</li>
        </ul><p>The easiest way to add the Sinch SDK is to use CocoaPods, in your Xcode project directory create a <em>Podfile</em> with the content below.</p>

<pre><code>platform :ios, '7.0'
pod 'SinchRTC'
</code></pre>

        <p>
            Open a terminal window in your Xcode project directory and type <br><code>pod install</code><br>
            Remember to open the workspace in Xcode when using CocoaPods.<br><em>If you are new to CocoaPods  go to <a href="http://cocoapods.org/">cocoapods.org</a> to learn how to install it</em>
        </p>

        <h2>Login</h2>

        <p>To enable app to app calling, it is necessary to start the <em>SINClient</em> with a username. In this example you will let the user type in any username they want with no password. </p>

        <p>Create a new ViewController (File&gt;New&gt;File)</p>

        <ul class="task-list">
            <li>Select objective-c class and click next</li>
            <li>
    Name the file <em>LoginViewController</em>
    Make sure UIViewController is the subclass.
            </li>
        </ul><p>Now, open the <strong>Main.Storyboard</strong> and add </p>

        <ul class="task-list">
            <li>A label with Username, </li>
            <li>
    Empty textbox<br>
            </li>
            <li>Button with the label Login</li>
        </ul>
        <div style="text-align:center;">
            <img src="readme_images/loginscreen.png" alt="" style="max-width:100%;">
        </div>

            <p>Set the custom class of the view to <strong>LoginViewController</strong>. </p>

            <p>Open the Assistant Editor (View&gt;Assitant Editor&gt;Show Assistant Editor). Create an outlet for the textfield by holding the control and dragging into <strong>LoginViewController.h</strong> in the Assistant Editor name the outlet username</p>

            <p>Next, create an action from the button by repeating the step from above, but choose action as connection. Name the method login:</p>

            <p><em>Sometimes the assistant chooses .m files instead of .h make sure you are in the right one</em></p>

            <p>Open <strong>LoginViewController.m</strong> add <code>@synthesize userName;</code> below the <a href="https://github.com/implementation" class="user-mention">@implementation</a> line.</p>

            <h2>Login action</h2>

            <p>
    When the user clicks on the login button you want to present the CallScreenView.<br>
    Add a a new view to your storyboard with:
            </p>

            <ul class="task-list">
    <li>A label with User to call, </li>
    <li>
        Empty textbox<br>
    </li>
    <li>Button with the label Call</li>
            </ul><p>
    Add a modal segue from the files owner of LoginViewController to the above CallscreenView and name it showCallScreen.<br>
    The storyboard should now look like this:
            </p>
            <div style="text-align:center;">
    <img src="readme_images/allscreensID.png" alt="" style="max-width:100%;">
            </div>
            <p>Open <strong>LoginViewController.m</strong> and add the login method for the button.</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">login:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">username</span><span class="p">.</span><span class="n">text</span> <span class="o">!=</span> <span class="nb">nil</span> <span class="p">)</span> <span class="p">{</span>
    <span class="p">[</span><span class="nb">self</span> <span class="nl">performSegueWithIdentifier</span><span class="p">:</span><span class="s">@"showCallScreen"</span> <span class="nl">sender</span><span class="p">:</span><span class="n">username</span><span class="p">.</span><span class="n">text</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
            </div>

            <p>
    The above code will perform the Segue if the username is not empty. To pass the username to the call screen you need to implement prepareForSegue <br>
    add the following code to <strong>LoginViewController.m</strong>
            </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">prepareForSegue:</span><span class="p">(</span><span class="bp">UIStoryboardSegue</span><span class="o">*</span><span class="p">)</span><span class="nv">segue</span> <span class="nf">sender:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span>
<span class="p">{</span>
    <span class="c1">// check that its the right segue</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">segue</span><span class="p">.</span><span class="n">identifier</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"showCallScreen"</span><span class="p">])</span>     <span class="p">{</span>
    <span class="c1">// TODO, get the view controller for call screen</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
            </div>

            <p>Compile and run the app, and you should now see the callscreen after pressing login.</p>

            <h2>Adding a CallScreenViewController</h2>

            <p>
    Create a new ViewController called <strong>CallScreenViewController</strong>. This controller will handle all call activity in the app.<br>
    Set the custom class of the view Callscreen to <strong>CallScreenViewController</strong> in interfacebuilder.<br>
    Open the <strong>CallScreenViewController.h</strong> and add the property
            </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
<span class="k">@interface</span> <span class="nc">CallScreenViewController</span> : <span class="bp">UIViewController</span>
<span class="k">@property</span> <span class="bp">NSString</span><span class="o">*</span> <span class="n">username</span><span class="p">;</span>
<span class="k">@end</span>
</pre>
            </div>

            <p>
    also add <code>@synthesize username</code> to the <strong>CallScreenViewController.m</strong> file.<br>
    Go back to LoginViewController.m and add <code>#import "CallScreenViewController.h"</code> to your imports. <br>
    Change <code>-(void)prepareForSegue:(UIStoryboardSegue*)segue sender:(id)sender</code> <br>
    to:
            </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-(</span><span class="kt">void</span><span class="p">)</span><span class="nf">prepareForSegue:</span><span class="p">(</span><span class="bp">UIStoryboardSegue</span><span class="o">*</span><span class="p">)</span><span class="nv">segue</span> <span class="nf">sender:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="c1">// Check that it's the right segue</span>
    <span class="k">if</span> <span class="p">([</span><span class="n">segue</span><span class="p">.</span><span class="n">identifier</span> <span class="nl">isEqualToString</span><span class="p">:</span><span class="s">@"showCallScreen"</span><span class="p">])</span> 
    <span class="p">{</span>
    <span class="c1">// Get destination viewController</span>
    <span class="n">CallScreenViewController</span> <span class="o">*</span><span class="n">vc</span> <span class="o">=</span> <span class="p">[</span><span class="n">segue</span> <span class="n">destinationViewController</span><span class="p">];</span>
    <span class="c1">// Set the username property of CallScreenViewController</span>
    <span class="n">vc</span><span class="p">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">sender</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre>
            </div>

            <h2>Call screen implementation</h2>

            <p>The CallScreenViewController will be responsible for handling all events from the Sinch client. To enable this, open <strong>CallScreenViewController.h</strong> and add the following import:</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="cp">#import &lt;Sinch/Sinch.h&gt;</span>
</pre>
            </div>

            <p>The CallScreenViewController must implement the SINCallClientDelegate and SINCallDelegate protocol. SINCallClientDelegate protocol handles events such as incoming call notification, and the  SINCallDelegate protocol handles in call events like when a call is connected or ended. </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="k">@interface</span> <span class="nc">CallScreenViewController</span> : 
<span class="bp">UIViewController</span> <span class="o">&lt;</span><span class="n">SINCallClientDelegate</span><span class="p">,</span> <span class="n">SINCallDelegate</span><span class="o">&gt;</span>
</pre>
            </div>

            <h2>Prepare to make a call</h2>

            <p>
    To make and receive calls you need an instance of the Sinch client. <br>
    Open <strong>CallScreenViewController.m</strong> <br>
    Add an instance variable to you CallScreenViewController.m
            </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="k">@interface</span> <span class="nc">CallScreenViewController</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="kt">id</span><span class="o">&lt;</span><span class="n">SINClient</span><span class="o">&gt;</span> <span class="n">_client</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>
</pre>
            </div>

            <p>Now add a method to start the client, make sure insert your application key and application secret here. When you are starting the client, everything necessary to handle calls are set up.  </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initSinchClient</span> <span class="p">{</span>
    <span class="n">_client</span> <span class="o">=</span> <span class="p">[</span><span class="n">Sinch</span> <span class="nl">clientWithApplicationKey</span><span class="p">:</span><span class="s">@"your_key"</span>
    <span class="nl">applicationSecret</span><span class="p">:</span><span class="s">@"your_secret"</span>
    <span class="nl">environmentHost</span><span class="p">:</span><span class="s">@"sandbox.sinch.com"</span>
    <span class="nl">userId</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">username</span><span class="p">];</span>
    <span class="n">_client</span><span class="p">.</span><span class="n">callClient</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">_client</span> <span class="nl">setSupportCalling</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="p">[</span><span class="n">_client</span> <span class="n">start</span><span class="p">];</span>
    <span class="p">[</span><span class="n">_client</span> <span class="n">startListeningOnActiveConnection</span><span class="p">];</span>
<span class="p">}</span>
</pre>
            </div>

            <p>Replace the code in <code>viewDidLoad</code> with the following</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nb">super</span> <span class="n">viewDidLoad</span><span class="p">];</span>
    <span class="p">[</span><span class="nb">self</span> <span class="n">initSinchClient</span><span class="p">];</span>
<span class="p">}</span>
</pre>
            </div>

            <h2>Making a call</h2>

            <p>Connect the user interface to enable the user to call. </p>

            <ul class="task-list">
    <li>Open <strong>Main.storyboard</strong> and select the call screen. </li>
    <li>Create an outlet for the textview call it remoteUsername</li>
    <li>
        Create an action for the button that you call <code>callUser:</code>
        Don't forget to synthezise them in  your .m file.
        Your <strong>CallScreenViewController.h</strong> should now look like this:
    </li>
            </ul><div class="highlight highlight-objectivec">
    <pre><span class="cp">#import &lt;UIKit/UIKit.h&gt;</span>
<span class="cp">#import &lt;Sinch/Sinch.h&gt;</span>
<span class="k">@interface</span> <span class="nc">CallScreenViewController</span> : 
    <span class="bp">UIViewController</span> <span class="o">&lt;</span><span class="n">SINCallDelegate</span><span class="p">,</span> <span class="n">SINCallClientDelegate</span><span class="o">&gt;</span>
<span class="k">@property</span> <span class="bp">NSString</span><span class="o">*</span> <span class="n">username</span><span class="p">;</span>
<span class="k">@property</span> <span class="p">(</span><span class="k">strong</span><span class="p">,</span> <span class="k">nonatomic</span><span class="p">)</span> <span class="kt">IBOutlet</span> <span class="bp">UITextField</span> <span class="o">*</span><span class="n">remoteUsername</span><span class="p">;</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">callUser:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span><span class="p">;</span>
<span class="k">@end</span>
</pre>
            </div>

            <p>Open <strong>CallScreenViewController.m</strong> add an instance variable for a call:</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span> <span class="n">_call</span><span class="p">;</span>
</pre>
            </div>

            <p>When user clicks call, set up a voice conversation in callUser:</p>

            <div class="highlight highlight-objectivec">
<pre><span class="p">-</span><span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">callUser:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="n">_call</span> <span class="o">=</span> <span class="p">[</span><span class="n">_client</span><span class="p">.</span><span class="n">callClient</span> <span class="nl">callUserWithId</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">remoteUsername</span><span class="p">.</span><span class="n">text</span><span class="p">];</span> <span class="c1">// Create the call</span>
    <span class="n">_call</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span> <span class="c1">// Listen for events on self</span>
<span class="p">}</span>
</pre>
            </div>

            <h2>Answering the call</h2>

            <p>To answer a call you need to add code in didReceiveIncomingCall. In this example you will accept all calls, but in a normal application you would display a UI where the user could accept or reject a call. </p>

            <div class="highlight highlight-objectivec">
<pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">client:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCallClient</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">client</span> <span class="nf">didReceiveIncomingCall:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">call</span> <span class="p">{</span>
    <span class="c1">// For now we are just going to answer calls, </span>
    <span class="c1">// in a normal app you would show in incoming call screen</span>
    <span class="n">call</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="n">_call</span> <span class="o">=</span> <span class="n">call</span><span class="p">;</span>
    <span class="p">[</span><span class="n">_call</span> <span class="n">answer</span><span class="p">];</span>
<span class="p">}</span>
</pre>
            </div>

            <p>
    Next implement the protocol for the call delegate. The different states of a phone call are: -inprogress (trying to connect), <br>
    -established <br>
    -ending<br>
    These events are quite useful for as a developer, because this is where you can record start times, and make changes UI to hangup calls etc.
            </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="cp">#pragma mark - SINCallDelegate</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">callDidProgress:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">call</span> <span class="p">{</span>
    <span class="c1">// In this method you can play ringing tone and update ui to display progress of call.</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">callDidEstablish:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">call</span> <span class="p">{</span>
    <span class="c1">// Called when a call connects.</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">callDidEnd:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">call</span> <span class="p">{</span>
    <span class="c1">// Called when call finnished.</span>
<span class="p">}</span>
</pre>
            </div>

            <h2>Run it</h2>

            <ul class="task-list">
    <li>Compile and run on the device emulator. </li>
    <li>
        Log in as <strong>A</strong>
    </li>
    <li>Compile and run on your iPhone </li>
    <li>
        Log in as <strong>B</strong>
        On the iphone type <strong>A</strong> in the to user call box, press <strong>Call</strong>.
        For testing I usually turn on some music on the computer and step outside the room to and listen in the iPhone.
    </li>
            </ul><h2>Hanging up the call</h2>

            <p>
    It pretty nice to be able to have a way to end the call. <br>
    Open up <strong>Main.storyboard</strong> and crate an outlet called callButton from the call call button.
            </p>

            <p>
    You want to change the text of the call button when a call changes state. Open <strong>CallScreenViewController.m</strong> add  callButton to your @synthezise.<br>
    Change the delegate methods.
            </p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">callDidEstablish:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">call</span> <span class="p">{</span>
    <span class="c1">// Change to hangup when the call is connected</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">callButton</span> <span class="nl">setTitle</span><span class="p">:</span><span class="s">@"Hang up"</span> <span class="nl">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
<span class="p">}</span>
<span class="p">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">callDidEnd:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINCall</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">call</span> <span class="p">{</span>
    <span class="c1">// Change to call again</span>
    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">callButton</span> <span class="nl">setTitle</span><span class="p">:</span><span class="s">@"Call"</span> <span class="nl">forState</span><span class="p">:</span><span class="n">UIControlStateNormal</span><span class="p">];</span>
    <span class="n">_call</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
<span class="p">}</span>
</pre>
            </div>

            <p>You also need to change the callUser function to hang up a call instead of dialing if a call is in progress,</p>

            <div class="highlight highlight-objectivec">
<pre><span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">callUser:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_call</span> <span class="o">==</span> <span class="nb">nil</span><span class="p">)</span><span class="p">{</span>
        <span class="n">_call</span> <span class="o">=</span> <span class="p">[</span><span class="n">_client</span><span class="p">.</span><span class="n">callClient</span> <span class="nl">callUserWithId</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">remoteUserId</span><span class="p">.</span><span class="n">text</span><span class="p">];</span>
      <span class="n">_call</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
      <span class="p">[</span><span class="n">_call</span> <span class="n">hangup</span><span class="p">];</span>
      <span class="n">_call</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
            </div>

            <h2>Problems</h2>

            <p>If you are running in to problems, there are a couple of easy things you can check:</p>

            <ul class="task-list">
    <li>Make sure application key and secret are correct </li>
    <li>Do you have an provisioning profile set</li>
    <li>If it still doesn't work, don't hesitate to email me at <a href="mailto:christian@sinch.com">christian@sinch.com</a> to ask questions. </li>
            </ul><h2>Add logging</h2>

            <p>To help you determine what is wrong, you can add logging on the <em>SINClient</em>. In  <strong>CallScreenViewController.h</strong> add the following protocol SINClientDelegate:</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="k">@interface</span> <span class="nc">CallScreenViewController</span> : <span class="bp">UIViewController</span> <span class="o">&lt;</span><span class="n">SINClientDelegate</span><span class="p">,</span> <span class="n">SINCallClientDelegate</span><span class="p">,</span> <span class="n">SINCallDelegate</span><span class="o">&gt;</span>
</pre>
            </div>

            <p>Also add the follwing methids to <strong>CallScreenViewController.h</strong>:</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="cp">#pragma mark - SINClientDelegate</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">clientDidStart:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINClient</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">client</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Sinch client started (version: %@)"</span><span class="p">,</span> <span class="p">[</span><span class="n">Sinch</span> <span class="n">version</span><span class="p">]);</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">clientDidStop:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINClient</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">client</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Sinch client stopped"</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">clientDidFail:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINClient</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">client</span> <span class="nf">error:</span><span class="p">(</span><span class="bp">NSError</span><span class="o">*</span><span class="p">)</span><span class="nv">error</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"Error: %@"</span><span class="p">,</span> <span class="n">error</span><span class="p">.</span><span class="n">localizedDescription</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">client:</span><span class="p">(</span><span class="kt">id</span><span class="o">&lt;</span><span class="n">SINClient</span><span class="o">&gt;</span><span class="p">)</span><span class="nv">client</span>
    <span class="nf">logMessage:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">message</span>
    <span class="nf">area:</span><span class="p">(</span><span class="bp">NSString</span> <span class="o">*</span><span class="p">)</span><span class="nv">area</span>
    <span class="nf">severity:</span><span class="p">(</span><span class="n">SINLogSeverity</span><span class="p">)</span><span class="nv">severity</span>
    <span class="nf">timestamp:</span><span class="p">(</span><span class="bp">NSDate</span> <span class="o">*</span><span class="p">)</span><span class="nv">timestamp</span> <span class="p">{</span>
    <span class="c1">// If you want all messages remove the if statement</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">severity</span> <span class="o">==</span> <span class="n">SINLogSeverityCritical</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@"%@"</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre>
            </div>

            <p>Set the delegate of the SINClient in <code>-(void)initSinchClientWithUserId:</code> as follows:</p>

            <div class="highlight highlight-objectivec">
    <pre><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">initSinchClientWithUserId:</span><span class="p">(</span><span class="bp">NSString</span><span class="o">*</span><span class="p">)</span><span class="nv">userId</span> <span class="p">{</span>
    <span class="n">_client</span> <span class="o">=</span> <span class="p">[</span><span class="n">Sinch</span> <span class="nl">clientWithApplicationKey</span><span class="p">:</span><span class="s">@"your key"</span>
    <span class="nl">applicationSecret</span><span class="p">:</span><span class="s">@"your secret"</span>
    <span class="nl">environmentHost</span><span class="p">:</span><span class="s">@"sandbox.sinch.com"</span>
    <span class="nl">userId</span><span class="p">:</span><span class="nb">self</span><span class="p">.</span><span class="n">userName</span><span class="p">];</span>
    <span class="c1">// Add logging by setting delegate to self</span>
    <span class="n">_client</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">_client</span> <span class="nl">setSupportCalling</span><span class="p">:</span><span class="nb">YES</span><span class="p">];</span>
    <span class="n">_client</span><span class="p">.</span><span class="n">callClient</span><span class="p">.</span><span class="n">delegate</span> <span class="o">=</span> <span class="nb">self</span><span class="p">;</span>
    <span class="p">[</span><span class="n">_client</span> <span class="n">start</span><span class="p">];</span>
    <span class="p">[</span><span class="n">_client</span> <span class="n">startListeningOnActiveConnection</span><span class="p">];</span>
<span class="p">}</span>
</pre>
            </div>
        </div>
</body>
</html>
<!-- This document was created with MarkdownPad, the Markdown editor for Windows (http://markdownpad.com) -->
